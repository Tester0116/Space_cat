function YmEc(b){const a=this;let products={};let cartItems={};let detailProductId=null;let currency=null;let hasActiveVariation=false;let sentDetails=[];let dataLayerName=b.hasOwnProperty("dataLayerName")?b.dataLayerName:"DataLayer";window[b.dataLayerName]=window[b.dataLayerName]||[];this.addData=function(e){if(!e){return}if(e.products){this.registerProducts(e.products)}if(e.cartItems){this.registerCartItems(e.cartItems)}if(e.currency){this.setCurrency(e.currency)}if(e.detailProductId){this.setDetailProductId(e.detailProductId)}if(e.hasActiveVariation){hasActiveVariation=true}if(e.actions){for(var c in e.actions){var d=e.actions[c];this.send(d.type,d.data)}}if(e.purchase){this.sendPurchase(e.purchase.actionField,e.purchase.products)}};this.registerCartItem=function(d,c){cartItems[d]=c};this.registerProduct=function(f,c){if(typeof c==="string"){console.log(c);try{c=JSON.parse(c)}catch(d){console.log("При регистрации товара произошла ошибка - неверная JSON строка");return}}products[f]=c};this.registerProducts=function(d){for(var c in d){if(!d.hasOwnProperty(c)){continue}a.registerProduct(c,d[c])}};this.registerCartItems=function(c){for(var d in c){if(!c.hasOwnProperty(d)){continue}a.registerCartItem(d,c[d])}};this.isDetail=function(){return !!detailProductId};this.hasActiveVariation=function(){return hasActiveVariation};this.setDetailProductId=function(c){detailProductId=c};this.setCurrency=function(c){currency=c};this.getCurrency=function(){return currency};this.getDetailProductId=function(){return detailProductId};this.getProduct=function(c){return products[c]||null};this.getProductByHash=function(d){if(!cartItems.hasOwnProperty(d)){return null}const c=cartItems[d].id;return products[c]||null};this.getProducts=function(){return products};this.getCartItems=function(){return cartItems};this.clearCartItems=function(){cartItems={}};this.clearProducts=function(){products={}};this.updateCartItems=function(h){for(let hash in cartItems){const c=cartItems[hash];if(typeof h[hash]==="undefined"){this.send("remove",hash,{quantity:c.quantity});delete cartItems[hash]}}for(let hash in h){const e=h[hash];const d=cartItems[hash];const g=Math.abs(e.quantity-d.quantity);const f=e.quantity>d.quantity?"add":"remove";if(g>0){this.send(f,hash,{quantity:g})}d.quantity=e.quantity}};this.send=function(e,f,d){if(["string","number"].indexOf(typeof f)>-1){f=a.getProduct(f)}if(!f){console.log("Не удалось найти данные товара для отправки в электронную коммерцию",f);return}d=d||{};for(let key in d){if(!d.hasOwnProperty(key)){continue}f[key]=d[key]}const c={ecommerce:{}};c.ecommerce[e]={products:[f]};if(currency){c.ecommerce["currencyCode"]=currency}window[b.dataLayerName].push(c)};this.sendPurchase=function(e,d){const c={ecommerce:{purchase:{actionField:e,products:d}}};if(currency){c.ecommerce["currencyCode"]=currency}window[b.dataLayerName].push(c)}};